def app_dir = 'spring-boot-hello-world'
def gitRepoUrl = 'https://github.com/wendytallytlhgithub932/TestSpringBoot.git'
def gitBranch = 'main'
def gitFilePath = '/'

// Define the JAR file name (adjust as needed)
//def jarFileName = 'target/*.jar'

pipeline {
    agent {
        docker {
            image 'my-java-image:latest'
            args '-v /var/run/docker.sock:/var/run/docker.sock'
        }
    }

    stages {
        stage('Checkout') {
            steps {
		sh 'echo "******before checkout code******"'
                sh 'pwd'
                sh 'ls -lrt'
		sh 'echo "clean" before download code'
		sh 'rm -rf TestSpringBoot*
		sh 'ls -lrt'
                // Checkout the code from the Git repository
                checkout([$class: 'GitSCM', branches: [[name: '*/main']], 
                doGenerateSubmoduleConfigurations: false, 
                extensions: [[$class: 'CleanBeforeCheckout'], [$class: 'CloneOption', 
                noTags: false, reference: '', shallow: true, timeout: 10]], 
                submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'wendytallytlhgithub932', 
                url: 'https://github.com/wendytallytlhgithub932/TestSpringBoot.git']]])
                sh 'echo "******after checkout code******"'
                sh 'pwd'
                sh 'ls -lrt'

            }
        }

        stage('Build') {
            steps {
                sh '\'pwd\''
//                dir('spring-boot-hello-world') {
                dir("$app_dir") {
                    // Perform actions in the specified directory
                    sh 'ls -l' // Example: List files in the specified directory
                   // sh 'mvn clean install -Dmaven.test.skip=true'
                    sh 'mkdir target'
                    sh 'touch target/test.jar'
                }
 
            }
        }

      stage('Test') {
            steps {
                sh 'echo $app_dir'
                // Replace with your Git repository URL and branch
				    sh """
				        pwd
				        
				    """
            }
      }
      
     stage('Push')
	 {
		steps 
		{
			sh 'echo "in push"'
			sh 'pwd'
			sh 'ls -lrt'
			
			sh """
					rm -rf store
                    git clone https://github.com/wendytallytlhgithub932/store.git
					cd store
                    git config --global user.email "wendy.tally.tlh@gmail.com"
                    git config --global user.name "wendytallytlhgithub932"
					git remote -v
                    git checkout main
                    cp ../$app_dir/target/*.jar .
                    git add *.jar
					git status
					git branch
                    git commit -m "Add jar files"
					git remote -v
                    git push origin main
			//this statement does not work yet
                """
		}
	 }
      
	  
	}
}
